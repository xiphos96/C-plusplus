<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Wide Character/Unicode support in ACE</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.13.1 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; <a class="qindex" href="pages.html">Related Pages</a> &nbsp; </center>
<hr><a name="wchar"><h2>Wide Character/Unicode support in ACE</h2></a>

<p>
Here's a first stab at some sort of documentation for the magic wide-character (wchar) stuff in <a class="el" href="classACE.html">ACE</a>. It should be possible to compile <a class="el" href="classACE.html">ACE</a> with wchar support on most platforms that <a class="el" href="classACE.html">ACE</a> runs on. In some cases, we don't enable wchar support by default since it increases the footprint a bit. If you run into any problems, please use the $ACE_ROOT/PROBLEM-REPORT-FORM to let us know.
<p>
<a name="wchar_overview"><h3>Overview</h3></a>

<p>
There are three different wchar configurations that <a class="el" href="classACE.html">ACE</a> can use. These are no support mode, regular support mode, and full support mode (well, those are the best names I can come up with for now).
<p>
<a name="wchar_nosupport"><h3>No Support</h3></a>

<p>
By default, <a class="el" href="classACE.html">ACE</a> will not use wchar_t at all. This is for platforms where wchar_t does not exist or support for it is pretty flakey.
<p>
<a name="wchar_regular"><h3>Regular Support</h3></a>

<p>
If ACE_HAS_WCHAR is defined, then <a class="el" href="classACE.html">ACE</a> classes will be expanded to have extra methods which take in wchar_t strings. Note that all the methods available with No Support are also available here. This is the default in Windows right now, and has been tested to work on Linux and VxWorks (well, only been tested to compile/link of VxWorks).
<p>
<a name="wchar_full"><h3>Full Support</h3></a>

<p>
Full support is turned on if ACE_HAS_WCHAR and ACE_USES_WCHAR are defined. Like Regular Support, both char and wchar_t versions of some methods are available, but unlike Regular Support, other methods that have char arguments or return values may have wchar_t arguments or return values.
<p>
This has only been tested in Windows, and is the default for Windows CE.
<p>
<a name="wchar_othermacros"><h3>Other Important Macros</h3></a>

<p>
In addition to the ACE_HAS_WCHAR and ACE_USES_WCHAR mentioned above, there are several other macros that are important when using wide character support in <a class="el" href="classACE.html">ACE</a>.
<p>
These other macros are used in code to conditionally switch between char and wchar_t. ACE_TCHAR is a char normally and wchar_t when ACE_USES_WCHAR is defined. ACE_TEXT ("foo") expands to "foo" normally and L"foo" when ACE_USES_WCHAR is defined.
<p>
ACE_TEXT_CHAR_TO_TCHAR and ACE_TEXT_WCHAR_TO_TCHAR are used when a string that is always a char or wchar_t string needs to be converted to a ACE_TCHAR string. On the same note, ACE_TEXT_ALWAYS_CHAR is used when a string is ACE_TCHAR * and needs to be a char * string.
<p>
ACE_TEXT_WIDE ("foo") is unique in that it always maps to L"foo". It is not a conditional macro.
<p>
For string constants in code, ACE_TEXT and ACE_LIB_TEXT are used to put the Unicode prefix (Usually 'L') before the string when needed. By default both are controlled by ACE_USES_WCHAR.
<p>
All <a class="el" href="classACE.html">ACE</a> code except for the <a class="el" href="classACE.html">ACE</a> library should use ACE_TEXT. ACE_LIB_TEXT was introduced as a short-term fix for backwards compatibility purposes. This allows ACE_TEXT to be overriden to act just like TEXT in Microsoft Windows while not affecting <a class="el" href="classACE.html">ACE</a>'s interface. In the future ACE_LIB_TEXT and this backwards compatibility will be deprecated and removed.
<p>
Finally, on Windows there are a bunch of ACE_TEXT_Apicall type macros which are used to choose the correct version of a Win32 API function depending on ACE_USES_WCHAR. I'm hoping to remove these by adding a new ACE_OS_Win32 class to perform the same task, but until then these ugly macros get the job done.
<p>
<a name="wchar_logmsg"><h3>ACE_Log_Msg support</h3></a>

<p>
One of the more troublesome aspect of supporting wide and Ansi strings is the fact that the format strings for ACE_DEBUG and family always had to have ACE_TEXT (or ACE_LIB_TEXT) around them.
<p>
Now this should not be the case, since <a class="el" href="classACE__Log__Msg.html">ACE_Log_Msg</a> was extended to support both types of format strings concurrently. This is okay, but when strings are printed out via the format_string, care has to be taken.
<p>
It is interesting how Unix and Windows treats the format specifiers differently, based on their history. Win32 uses s, c, S and C, whereas Linux seems to use s, c, ls, and lc. And they even treat s and c differently. The route <a class="el" href="classACE.html">ACE</a> takes is a bit of a mixture of both:
<p>
<ul>
<li>c: prints out an Ansi character<li>C: prints out an Ansi string<li>s: prints out an ACE_TCHAR string<li>w: prints out a Wide character<li>W: prints out a Wide string</ul>
An example, which will also function correctly even when ACE_USES_WCHAR is defined:
<p>
<div class="fragment"><pre>
void print (char *a_str, wchar_t *w_str, ACE_TCHAR *t_str)
{
    ACE_DEBUG ((LM_DEBUG,
                "%C %s %W\n",
                a_str,
                t_str,
                w_str));
}
</pre></div>
<p>
<a name="wchar_win32macros"><h3>Relation to Win32's UNICODE and _UNICODE macros</h3></a>

<p>
It used to be that in previous versions of <a class="el" href="classACE.html">ACE</a> that the Win32 macros affected <a class="el" href="classACE.html">ACE</a> in some way. This has been all removed in favor of the ACE_USES_WCHAR and ACE_HAS_WCHAR macros. Along with this, the definition of some of the Win32 string types (LPTSTR, LPCSTR, etc.) have been also removed. Since this isn't a direct concern of <a class="el" href="classACE.html">ACE</a>, they will have to be defined separately if they are needed on non-Win32 platforms.
<p>
The way I'd recommend doing this is to add the typdefs to config.h.
<p>
<a name="wchar_legacy"><h3>Legacy Support</h3></a>

<p>
Most of the old macros (ACE_HAS_UNICODE, ACE_HAS_MOSTLY_UNICODE_APIS) are ignored by default by <a class="el" href="classACE.html">ACE</a>, since the new macros replaced them. If ACE_LEGACY_MODE is defined, there is an attempt to map them to the new scheme by just ACE_HAS_UNICODE == ACE_HAS_WCHAR and ACE_HAS_MOSTLY_UNICODE_APIS == ACE_USES_WCHAR.
<p>
<hr><address><small>Generated on Wed Jan 15 19:17:21 2003 for ACE by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.13.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
