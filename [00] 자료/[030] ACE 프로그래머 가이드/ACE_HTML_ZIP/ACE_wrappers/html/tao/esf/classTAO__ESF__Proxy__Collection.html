<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title> TemplateTAO_ESF_Proxy_Collection class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.13.1 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>TAO_ESF_Proxy_Collection  Class Template Reference</h1>ESF_Proxy_Collection. 
<a href="#_details">More...</a>
<p>
<code>#include &lt;ESF_Proxy_Collection.h&gt;</code>
<p>
Inheritance diagram for TAO_ESF_Proxy_Collection:<p><center><img src="classTAO__ESF__Proxy__Collection__inherit__graph.gif" border="0" usemap="#TAO__ESF__Proxy__Collection_3_01PROXY_01_4__inherit__map" alt="Inheritance graph"></center>
<map name="TAO__ESF__Proxy__Collection_3_01PROXY_01_4__inherit__map">
<area href="classTAO__ESF__Copy__On__Read.html" shape="rect" coords="334,7,577,25" alt="">
<area href="classTAO__ESF__Copy__On__Write.html" shape="rect" coords="334,57,577,76" alt="">
<area href="classTAO__ESF__Delayed__Changes.html" shape="rect" coords="327,104,583,123" alt="">
<area href="classTAO__ESF__Delayed__Changes.html" shape="rect" coords="1009,128,1553,147" alt="">
<area href="classTAO__ESF__Immediate__Changes.html" shape="rect" coords="321,209,590,228" alt="">
</map>
<center><font size="2">[<a href="graph_legend.html">legend</a>]</font></center><a href="classTAO__ESF__Proxy__Collection-members.html">List of all members.</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td colspan=2><br><h2>Public Methods</h2></td></tr>
<tr><td nowrap align=right valign=top>virtual&nbsp;</td><td valign=bottom><a class="el" href="classTAO__ESF__Proxy__Collection.html#a0">~TAO_ESF_Proxy_Collection</a> (void)</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>destructor.</em> <a href="#a0">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="classTAO__ESF__Proxy__Collection.html#a1">for_each</a> (<a class="el" href="classTAO__ESF__Worker.html">TAO_ESF_Worker</a>&lt; PROXY &gt; *worker <a class="elRef" doxygen="ACE.tag:../../ace/" href="../../ace/CORBA__macros_8h.html#a35">ACE_ENV_ARG_DECL</a>)=0</td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="classTAO__ESF__Proxy__Collection.html#a2">connected</a> (PROXY *proxy <a class="elRef" doxygen="ACE.tag:../../ace/" href="../../ace/CORBA__macros_8h.html#a35">ACE_ENV_ARG_DECL</a>)=0</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Insert a new element into the collection. The collection assumes ownership of the element.</em> <a href="#a2">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="classTAO__ESF__Proxy__Collection.html#a3">reconnected</a> (PROXY *proxy <a class="elRef" doxygen="ACE.tag:../../ace/" href="../../ace/CORBA__macros_8h.html#a35">ACE_ENV_ARG_DECL</a>)=0</td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="classTAO__ESF__Proxy__Collection.html#a4">disconnected</a> (PROXY *proxy <a class="elRef" doxygen="ACE.tag:../../ace/" href="../../ace/CORBA__macros_8h.html#a35">ACE_ENV_ARG_DECL</a>)=0</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>Remove an element from the collection.</em> <a href="#a4">More...</a><em></em></font><br><br></td></tr>
<tr><td nowrap align=right valign=top>virtual void&nbsp;</td><td valign=bottom><a class="el" href="classTAO__ESF__Proxy__Collection.html#a5">shutdown</a> (<a class="elRef" doxygen="ACE.tag:../../ace/" href="../../ace/CORBA__macros_8h.html#a38">ACE_ENV_SINGLE_ARG_DECL</a>)=0</td></tr>
<tr><td>&nbsp;</td><td><font size=-1><em>The EC is shutting down, must release all the elements.</em> <a href="#a5">More...</a><em></em></font><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
<h3>template&lt;class PROXY&gt;<br>
 class TAO_ESF_Proxy_Collection&lt; PROXY &gt;</h3>

ESF_Proxy_Collection.
<p>

<p>
 Many components in an Event Service need to keep a collection of proxies; these collections must be able to cope with several concurrency issues: + Some threads may need to iterate over the collection and invoke a method on each element. Locking the collection while this is done is not feasible in all cases: under some configurations the same thread that is iterating over the collection may need to make changes to the set. + A recursive lock does not solve the concurrency problems because recursive changes to the collection still invalidate the iterators.
<p>
There are several solutions to this problem (see the VARIANTS) section, and there is no single one that works bests in all cases. As usual, we wish the strategize the protocol used to serialize iterations and changes to the collection. This class encapsulates that protocol.
<p>
The usual form of the Iterator pattern does not work well in this case: in several variants the synchronization protocol and the iteration loop must collaborate to work efficiently. Exposing an external iterator would require that every other component in the system can support all the synchronization protocols. It is possible to hide some of that complexity using heavy weight iterators, but their use is ackward, specially since the Koening-style iterators have become more popular.
<p>
Regular member functions are used to insert, remove and update members of the collection and to shutdown (i.e. perform final cleanup operations).
<p>
The class must also collaborate with other components of the EC to efficiently and safely perform memory managment of the members in the collection.
<p>
The PROXY object must be reference counted with the following operations:
<p>
+ _incr_refcnt() - increment the reference count. + _decr_refcnt() - decrement the reference count.
<p>
= VARIANTS
<p>
We identify several sources of variation:
<p>
+ Immediate_Changes: in this variant the iteration in performed while holding some kind of synchronization primitive, such as a thread mutex, a recursive mutex, a RW lock, etc. This is only useful in configurations where a separate thread dispatches the events, and thus, can only be used with real locks. + Copy_On_Read: before performing the iteration the collection is duplicated into a temporary array. Thus no locks are held during the iteration. This is a very expensive approach, but useful in many cases. The kind of lock is also strategized in this case. + Copy_On_Write: this is very similar to the previous approach, but the collection is only duplicated when a change is required while some thread is performing an iteration. The iteration continues over the original copy, while the changes are performed in the duplicate. The new copy of the collection is used for any subsequent operations, the original is discarded when the last thread using it completes its work. This approach optimizes for the case where no changes are is duplicated into a temporary array. Thus no locks are held during the iteration. This is a very expensive approach, but useful in many cases. The kind of lock is also strategized in this case. + Delayed_Changes: before starting the iteration a counter is incremented, this counter is used to keep track of the number of threads concurrently using the collection. If a thread wants to perform a change to the collection it must first verify that there are no threads iterating over it. If there are any threads then the thread queues the modification for later execution, using the Command pattern. The kind of lock is strategized, as this approach is used in single threaded configurations. There are two main variations:<ul>
<li>An upcall can result in new dispatches: in this case we have to keep track of a the list of current threads using a Set, to avoid dead-locks. The design is not complete, probably similar to the next one.<li>Otherwise we just need to control the concurrency using the algorithm described below.</ul>
It assumes ownership of the proxies added to the collection, it increases the reference count.
<p>
Locking is provided by derived classes. 
<p>
<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a name="a0" doxytag="TAO_ESF_Proxy_Collection::~TAO_ESF_Proxy_Collection"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" colspan="4">
template&lt;class PROXY&gt; </td>
        </tr>
        <tr>
          <td class="md" nowrap valign="top"> TAO_ESF_Proxy_Collection&lt; PROXY &gt;::~TAO_ESF_Proxy_Collection </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">void&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp;          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
destructor.
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a name="a2" doxytag="TAO_ESF_Proxy_Collection::connected"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" colspan="4">
template&lt;class PROXY&gt; </td>
        </tr>
        <tr>
          <td class="md" nowrap valign="top"> virtual void TAO_ESF_Proxy_Collection&lt; PROXY &gt;::connected </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PROXY *proxy&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>ACE_ENV_ARG_DECL</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap><code> [pure virtual]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Insert a new element into the collection. The collection assumes ownership of the element.
<p>

<p>
Reimplemented in <a class="el" href="classTAO__ESF__Copy__On__Read.html#a3">TAO_ESF_Copy_On_Read</a>, <a class="el" href="classTAO__ESF__Copy__On__Write.html#a3">TAO_ESF_Copy_On_Write</a>, <a class="el" href="classTAO__ESF__Delayed__Changes.html#a10">TAO_ESF_Delayed_Changes</a>, <a class="el" href="classTAO__ESF__Immediate__Changes.html#a3">TAO_ESF_Immediate_Changes</a>, and <a class="el" href="classTAO__ESF__Delayed__Changes.html#a10">TAO_ESF_Delayed_Changes&lt; PROXY, COLLECTION, ITERATOR, ACE_SYNCH_USE &gt;</a>.    </td>
  </tr>
</table>
<a name="a4" doxytag="TAO_ESF_Proxy_Collection::disconnected"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" colspan="4">
template&lt;class PROXY&gt; </td>
        </tr>
        <tr>
          <td class="md" nowrap valign="top"> virtual void TAO_ESF_Proxy_Collection&lt; PROXY &gt;::disconnected </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PROXY *proxy&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>ACE_ENV_ARG_DECL</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap><code> [pure virtual]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Remove an element from the collection.
<p>

<p>
Reimplemented in <a class="el" href="classTAO__ESF__Copy__On__Read.html#a5">TAO_ESF_Copy_On_Read</a>, <a class="el" href="classTAO__ESF__Copy__On__Write.html#a5">TAO_ESF_Copy_On_Write</a>, <a class="el" href="classTAO__ESF__Delayed__Changes.html#a12">TAO_ESF_Delayed_Changes</a>, <a class="el" href="classTAO__ESF__Immediate__Changes.html#a5">TAO_ESF_Immediate_Changes</a>, and <a class="el" href="classTAO__ESF__Delayed__Changes.html#a12">TAO_ESF_Delayed_Changes&lt; PROXY, COLLECTION, ITERATOR, ACE_SYNCH_USE &gt;</a>.    </td>
  </tr>
</table>
<a name="a1" doxytag="TAO_ESF_Proxy_Collection::for_each"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" colspan="4">
template&lt;class PROXY&gt; </td>
        </tr>
        <tr>
          <td class="md" nowrap valign="top"> virtual void TAO_ESF_Proxy_Collection&lt; PROXY &gt;::for_each </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classTAO__ESF__Worker.html">TAO_ESF_Worker</a>&lt; PROXY &gt; *worker&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>ACE_ENV_ARG_DECL</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap><code> [pure virtual]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Iterate over the collection and invoke worker-&gt;work() for each member of the collection. This encapsulates 
<p>
Reimplemented in <a class="el" href="classTAO__ESF__Copy__On__Read.html#a2">TAO_ESF_Copy_On_Read</a>, <a class="el" href="classTAO__ESF__Copy__On__Write.html#a2">TAO_ESF_Copy_On_Write</a>, <a class="el" href="classTAO__ESF__Delayed__Changes.html#a9">TAO_ESF_Delayed_Changes</a>, <a class="el" href="classTAO__ESF__Immediate__Changes.html#a2">TAO_ESF_Immediate_Changes</a>, and <a class="el" href="classTAO__ESF__Delayed__Changes.html#a9">TAO_ESF_Delayed_Changes&lt; PROXY, COLLECTION, ITERATOR, ACE_SYNCH_USE &gt;</a>.    </td>
  </tr>
</table>
<a name="a3" doxytag="TAO_ESF_Proxy_Collection::reconnected"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" colspan="4">
template&lt;class PROXY&gt; </td>
        </tr>
        <tr>
          <td class="md" nowrap valign="top"> virtual void TAO_ESF_Proxy_Collection&lt; PROXY &gt;::reconnected </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">PROXY *proxy&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp; <em>ACE_ENV_ARG_DECL</em>          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap><code> [pure virtual]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Insert an element into the collection. No errors can be raised if the element is already present. The collection assumes ownership, i.e. must invoke &lt;proxy-&gt;_decr_refcnt()&gt; if the element is already present in the collection. 
<p>
Reimplemented in <a class="el" href="classTAO__ESF__Copy__On__Read.html#a4">TAO_ESF_Copy_On_Read</a>, <a class="el" href="classTAO__ESF__Copy__On__Write.html#a4">TAO_ESF_Copy_On_Write</a>, <a class="el" href="classTAO__ESF__Delayed__Changes.html#a11">TAO_ESF_Delayed_Changes</a>, <a class="el" href="classTAO__ESF__Immediate__Changes.html#a4">TAO_ESF_Immediate_Changes</a>, and <a class="el" href="classTAO__ESF__Delayed__Changes.html#a11">TAO_ESF_Delayed_Changes&lt; PROXY, COLLECTION, ITERATOR, ACE_SYNCH_USE &gt;</a>.    </td>
  </tr>
</table>
<a name="a5" doxytag="TAO_ESF_Proxy_Collection::shutdown"></a><p>
<table width="100%" cellpadding="2" cellspacing="0" border="0">
  <tr>
    <td class="md">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" colspan="4">
template&lt;class PROXY&gt; </td>
        </tr>
        <tr>
          <td class="md" nowrap valign="top"> virtual void TAO_ESF_Proxy_Collection&lt; PROXY &gt;::shutdown </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="elRef" doxygen="ACE.tag:../../ace/" href="../../ace/CORBA__macros_8h.html#a38">ACE_ENV_SINGLE_ARG_DECL</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>&nbsp;          </td>
          <td class="md" valign="top">)&nbsp;</td>
          <td class="md" nowrap><code> [pure virtual]</code></td>
        </tr>

      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The EC is shutting down, must release all the elements.
<p>

<p>
Reimplemented in <a class="el" href="classTAO__ESF__Copy__On__Read.html#a6">TAO_ESF_Copy_On_Read</a>, <a class="el" href="classTAO__ESF__Copy__On__Write.html#a6">TAO_ESF_Copy_On_Write</a>, <a class="el" href="classTAO__ESF__Delayed__Changes.html#a13">TAO_ESF_Delayed_Changes</a>, <a class="el" href="classTAO__ESF__Immediate__Changes.html#a6">TAO_ESF_Immediate_Changes</a>, and <a class="el" href="classTAO__ESF__Delayed__Changes.html#a13">TAO_ESF_Delayed_Changes&lt; PROXY, COLLECTION, ITERATOR, ACE_SYNCH_USE &gt;</a>.    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="ESF__Proxy__Collection_8h.html">ESF_Proxy_Collection.h</a><li><a class="el" href="ESF__Proxy__Collection_8cpp.html">ESF_Proxy_Collection.cpp</a></ul>
<hr><address><small>Generated on Wed Jan 15 23:21:12 2003 for TAO_ESF by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.13.1 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2001</small></address>
</body>
</html>
